# 快速使用指南

## 🚀 快速开始

### 1. 查看门控值可视化

已生成的可视化文件：

```bash
# 测试结果的门控值分析（6个子图）
experiments/lightweight_ccga/gate_analysis.png

# 综合门控值分析（训练+测试）
experiments/gate_visualization/comprehensive_gate_analysis.png
```

**直接打开这些PNG文件即可查看！**

---

## 📊 可视化内容说明

### gate_analysis.png（测试结果分析）

包含6个子图：

1. **左上 - Gate值分布直方图**
   - 显示所有测试样本的gate值分布
   - 红色虚线：平均值（0.500）
   - 灰色虚线：平衡点（0.5）

2. **中上 - 每个类别的箱线图**
   - 显示7个类别的gate值分布
   - 所有类别都稳定在0.5

3. **右上 - 总体比例饼图**
   - 蓝色：深度学习贡献（50.0%）
   - 绿色：物理先验贡献（50.0%）

4. **左下 - 每个类别的比例柱状图**
   - 蓝色柱：深度学习比例
   - 绿色柱：物理先验比例
   - 每个类别都是50%-50%

5. **中下 - 堆叠柱状图**
   - 每个类别的贡献比例堆叠显示
   - 总高度100%

6. **右下 - 统计表格**
   - 详细的数值信息
   - 包含每个类别的gate值、深度学习%、物理先验%

### comprehensive_gate_analysis.png（综合分析）

包含6个子图：

1. **左上 - Gate值演化曲线**
   - 蓝色线：训练集gate值
   - 红色线：测试集gate值
   - 灰色虚线：平衡点（0.5）
   - 灰色区域：±5%范围

2. **中上 - 训练集DL vs Physics比例**
   - 蓝色线：深度学习贡献
   - 绿色线：物理先验贡献

3. **右上 - 测试集DL vs Physics比例**
   - 蓝色线：深度学习贡献
   - 绿色线：物理先验贡献

4. **左下 - 训练集堆叠面积图**
   - 蓝色区域：深度学习贡献
   - 绿色区域：物理先验贡献
   - 白色虚线：50%分界线

5. **中下 - 测试集堆叠面积图**
   - 蓝色区域：深度学习贡献
   - 绿色区域：物理先验贡献
   - 白色虚线：50%分界线

6. **右下 - 统计信息表格**
   - 训练集和测试集的统计信息
   - 关键发现总结

---

## 🎯 关键结果解读

### Gate值 = 0.500 意味着什么？

```
最终注意力得分 = 0.5 × 数据驱动得分 + 0.5 × 物理先验得分
```

- 🔵 **深度学习（50%）**: 从训练数据中学习的模式
- 🟢 **物理先验（50%）**: VV-VH相干矩阵提供的物理知识

### 为什么是50%-50%？

✅ **网络自适应学习的结果**
- CCGA模块通过训练自动学习最优融合比例
- 不是人为设定，而是网络认为这是最优策略

✅ **两种知识源互补**
- 深度学习：捕捉复杂的数据模式
- 物理先验：提供可靠的物理约束
- 两者结合达到100%准确率

✅ **稳定且一致**
- 所有类别都采用相同比例
- 训练集和测试集一致
- 说明这是一个通用的最优策略

---

## 🔧 重新生成可视化

### 方法1：使用已有模型测试

```bash
python test_lightweight_ccga.py \
    --model_path experiments/lightweight_ccga/best_model.pth \
    --dataset tongyi_weidu_10x \
    --num_workers 0 \
    --save_results
```

**输出**: `experiments/lightweight_ccga/gate_analysis.png`

### 方法2：生成综合可视化

```bash
python visualize_gate_ratio.py
```

**输出**: `experiments/gate_visualization/comprehensive_gate_analysis.png`

### 方法3：重新训练（包含训练过程可视化）

```bash
python train_lightweight_ccga.py \
    --dataset tongyi_weidu_10x \
    --batch_size 32 \
    --epochs 30 \
    --lr 0.001 \
    --num_workers 0 \
    --save_dir experiments/new_experiment
```

**输出**: 
- `experiments/new_experiment/gate_evolution.png` - 训练过程中的gate值演化
- `experiments/new_experiment/gate_history.json` - 门控值数据

---

## 📁 文件结构

```
jsy_dataset_and_model/
├── experiments/
│   ├── lightweight_ccga/
│   │   ├── best_model.pth              # 最佳模型
│   │   ├── gate_analysis.png           # 门控值分析图 ✨
│   │   └── confusion_matrix.png        # 混淆矩阵
│   │
│   └── gate_visualization/
│       ├── comprehensive_gate_analysis.png  # 综合分析图 ✨
│       └── gate_history.json                # 门控值数据
│
├── 门控值可视化说明.md                  # 详细说明文档
├── 轻量级CCGA训练总结.md                # 训练结果总结
└── 快速使用指南.md                      # 本文档
```

---

## 💡 常见问题

### Q1: 为什么gate值都是0.5？

**A**: 这是网络自适应学习的结果。CCGA模块通过训练发现，深度学习和物理先验各占50%时，模型性能最优（100%准确率）。

### Q2: 不同类别的gate值为什么相同？

**A**: 说明对于所有7个类别（PVC、二面角、含水、多分支、电缆、空洞、金属），平衡融合都是最优策略。这表明CCGA学到了一个通用的融合模式。

### Q3: 如何修改gate值？

**A**: Gate值是网络自适应学习的，不建议手动修改。如果想实验不同的融合比例，可以修改`network_code/modules/ccga.py`中的门控机制。

### Q4: 可视化图中的中文显示不正常怎么办？

**A**: 这是字体问题，不影响数据的正确性。图表中的英文标题和数值都是正确的。

---

## 📚 更多信息

- **门控值详细说明**: 查看 `门控值可视化说明.md`
- **CCGA技术原理**: 查看 `CCGA模块核心功能详解.md`
- **训练结果总结**: 查看 `轻量级CCGA训练总结.md`
- **数据集说明**: 查看 `工作区说明.md`

---

**更新时间**: 2025-11-24  
**版本**: v1.0

